---
title: Pandas 数据导入与导出
date: 2026-01-10
category: MachineLearning/Basic/pandas
tags:
  - Python
  - Pandas
description: 掌握 CSV、Excel、JSON 等格式的读写操作
image: https://img.yumeko.site/file/blog/PandasLearning.jpg
status: public
---

# 数据导入与导出

## 学习目标

- 掌握 CSV、Excel、JSON 等格式的读写
- 了解常用读取参数

## 读取数据

### CSV 文件读取

#### 基本读取

CSV（Comma-Separated Values）是最常用的数据交换格式，纯文本文件，每行代表一条记录。

```python
import pandas as pd

# 最简单的读取方式
df = pd.read_csv('file.csv')
```

**默认行为**：

- 第一行作为列名（header）
- 逗号 `,` 作为分隔符
- 自动推断数据类型
- UTF-8 编码

#### 指定参数读取

```python
# 完整参数示例
df = pd.read_csv(
    'file.csv',
    encoding='utf-8',     # 编码格式
    sep=',',              # 分隔符
    header=0,             # 第0行是列名
    index_col=0           # 第0列作为索引
)
```

**假设 file.csv 内容**：

```
ID,Name,Age,City,Salary
1,Alice,25,Beijing,8000
2,Bob,30,Shanghai,12000
3,Charlie,35,Guangzhou,15000
```

**读取结果**：

```
   ID     Name  Age       City  Salary
0   1    Alice   25    Beijing    8000
1   2      Bob   30   Shanghai   12000
2   3  Charlie   35  Guangzhou   15000
```

### 常用参数详解

| 参数          | 类型 | 说明                       | 示例                              |
| ------------- | ---- | -------------------------- | --------------------------------- |
| `sep`         | str  | 列分隔符                   | `sep=','` 或 `sep='\t'`（制表符） |
| `header`      | int  | 指定哪一行作为列名         | `header=0`（第一行，默认）        |
| `names`       | list | 自定义列名（覆盖原有列名） | `names=['A', 'B', 'C']`           |
| `usecols`     | list | 只读取指定的列             | `usecols=['Name', 'Age']`         |
| `nrows`       | int  | 只读取前 n 行              | `nrows=1000`（读取前1000行）      |
| `skiprows`    | int  | 跳过开头的 n 行            | `skiprows=2`（跳过前2行）         |
| `encoding`    | str  | 文件编码格式               | `encoding='utf-8'` 或 `'gbk'`     |
| `na_values`   | list | 指定哪些值视为缺失值       | `na_values=['NA', 'null', '']`    |
| `dtype`       | dict | 指定列的数据类型           | `dtype={'Age': int, 'Name': str}` |
| `parse_dates` | list | 将指定列解析为日期类型     | `parse_dates=['Date']`            |

#### 实用示例

**示例 1：读取大文件的一部分**

```python
# 只读取前 1000 行和指定的列
df = pd.read_csv(
    'large_file.csv',
    usecols=['Name', 'Age', 'Salary'],
    nrows=1000
)
```

**原理**：处理大文件时，限制行数和列数可以节省内存，加快加载速度。

**示例 2：处理中文编码问题**

```python
# 中文 CSV 常用 gbk 或 gb2312 编码
df = pd.read_csv('chinese_data.csv', encoding='gbk')
```

**说明**：Windows 系统生成的 CSV 文件通常使用 GBK 编码，如果出现乱码，尝试更改编码。

**示例 3：自定义列名**

```python
# 文件没有表头，手动指定列名
df = pd.read_csv(
    'no_header.csv',
    header=None,  # 没有表头
    names=['姓名', '年龄', '城市']
)
```

**示例 4：处理不同分隔符**

```python
# 读取制表符分隔的文件（TSV）
df = pd.read_csv('file.tsv', sep='\t')

# 读取分号分隔的文件
df = pd.read_csv('file.txt', sep=';')
```

### Excel 文件读取

#### 基本用法

```python
# 读取 Excel 文件（默认读取第一个工作表）
df = pd.read_excel('file.xlsx')

# 指定工作表名称
df = pd.read_excel('file.xlsx', sheet_name='Sheet1')

# 指定工作表索引（0 表示第一个工作表）
df = pd.read_excel('file.xlsx', sheet_name=0)
```

**注意**：需要安装 `openpyxl` 或 `xlrd` 库：

```bash
pip install openpyxl  # 用于 .xlsx 文件
pip install xlrd      # 用于旧版 .xls 文件
```

#### 读取多个工作表

```python
# 读取所有工作表（返回字典）
all_sheets = pd.read_excel('file.xlsx', sheet_name=None)

# 访问特定工作表
df1 = all_sheets['Sheet1']
df2 = all_sheets['Sheet2']

print(f"工作表名称: {all_sheets.keys()}")
```

**输出示例**：

```
工作表名称: dict_keys(['Sheet1', 'Sheet2', 'Sheet3'])
```

**应用场景**：一个 Excel 文件包含多个相关数据表时批量读取。

#### Excel 特有参数

```python
df = pd.read_excel(
    'file.xlsx',
    sheet_name='销售数据',
    header=0,           # 表头行
    index_col=0,        # 索引列
    usecols='A:D',      # 只读取 A 到 D 列
    skiprows=2,         # 跳过前两行
    nrows=100           # 只读取100行
)
```

**原理**：Excel 文件可能包含标题、说明等非数据行，使用 `skiprows` 可以跳过这些行。

### JSON 文件读取

#### 基本用法

JSON（JavaScript Object Notation）是一种轻量级的数据交换格式。

```python
# 读取 JSON 文件
df = pd.read_json('file.json')
```

#### JSON 格式类型

**1. 记录格式（orient='records'）**

```json
[
  { "Name": "Alice", "Age": 25, "City": "Beijing" },
  { "Name": "Bob", "Age": 30, "City": "Shanghai" }
]
```

```python
df = pd.read_json('file.json', orient='records')
```

**结果**：

```
    Name  Age      City
0  Alice   25   Beijing
1    Bob   30  Shanghai
```

**2. 列格式（orient='columns'，默认）**

```json
{
  "Name": { "0": "Alice", "1": "Bob" },
  "Age": { "0": 25, "1": 30 },
  "City": { "0": "Beijing", "1": "Shanghai" }
}
```

**3. 索引格式（orient='index'）**

```json
{
  "0": { "Name": "Alice", "Age": 25 },
  "1": { "Name": "Bob", "Age": 30 }
}
```

**说明**：不同的 JSON 结构需要指定正确的 `orient` 参数才能正确解析。

### 其他常见格式

#### SQL 数据库

```python
import sqlite3

# 从 SQLite 数据库读取
conn = sqlite3.connect('database.db')
df = pd.read_sql('SELECT * FROM table_name', conn)
conn.close()
```

**原理**：执行 SQL 查询，将结果转换为 DataFrame。

#### HTML 表格

```python
# 从网页中提取表格
tables = pd.read_html('https://example.com/data.html')
df = tables[0]  # 获取第一个表格
```

**说明**：自动识别网页中的 `<table>` 标签并解析。

#### 剪贴板

```python
# 从剪贴板读取（复制 Excel 数据后）
df = pd.read_clipboard()
```

**应用**：快速测试，从 Excel 复制数据后直接粘贴到代码中。

## 导出数据

数据处理完成后，需要将结果保存到文件中供后续使用。

### CSV 文件导出

```python
# 基本导出
df.to_csv('output.csv')
```

**默认行为**：

- 包含行索引（第一列）
- 使用逗号分隔
- UTF-8 编码

**结果示例** `output.csv`：

```
,Name,Age,City,Salary
0,Alice,25,Beijing,8000
1,Bob,30,Shanghai,12000
2,Charlie,35,Guangzhou,15000
```

#### 常用参数

```python
# 不保存行索引（推荐）
df.to_csv('output.csv', index=False)

# 指定编码（中文数据）
df.to_csv('output.csv', encoding='utf-8-sig')  # Excel 可正确打开中文

# 指定分隔符
df.to_csv('output.tsv', sep='\t', index=False)  # 制表符分隔

# 只保存部分列
df.to_csv('output.csv', columns=['Name', 'Age'], index=False)

# 追加到现有文件
df.to_csv('output.csv', mode='a', header=False, index=False)
```

**参数说明**：

- `index=False`：不保存行索引（避免多余的一列）
- `encoding='utf-8-sig'`：带 BOM 的 UTF-8，Excel 能正确识别中文
- `mode='a'`：追加模式（append），不覆盖原文件
- `header=False`：不写入列名（追加时避免重复表头）

**最佳实践**：

```python
# 导出供 Excel 使用的中文 CSV
df.to_csv('中文数据.csv', index=False, encoding='utf-8-sig')
```

### Excel 文件导出

```python
# 导出到 Excel
df.to_excel('output.xlsx', sheet_name='数据', index=False)
```

**优点**：

- 保留格式（与 CSV 相比）
- 支持多个工作表
- Excel 可直接打开，无编码问题

#### 导出多个工作表

```python
# 使用 ExcelWriter 导出多个工作表
with pd.ExcelWriter('report.xlsx') as writer:
    df1.to_excel(writer, sheet_name='销售数据', index=False)
    df2.to_excel(writer, sheet_name='统计汇总', index=False)
    df3.to_excel(writer, sheet_name='图表数据', index=False)
```

**输出结果**：一个 Excel 文件包含 3 个工作表。

**应用场景**：生成数据报告，不同工作表存储不同类型的数据。

### JSON 文件导出

```python
# 导出为 JSON（记录格式）
df.to_json('output.json', orient='records', force_ascii=False, indent=2)
```

**参数说明**：

- `orient='records'`：每行数据是一个字典（最常用格式）
- `force_ascii=False`：保留中文字符（不转义）
- `indent=2`：缩进格式化（美化输出）

**输出结果** `output.json`：

```json
[
  {
    "Name": "Alice",
    "Age": 25,
    "City": "Beijing",
    "Salary": 8000
  },
  {
    "Name": "Bob",
    "Age": 30,
    "City": "Shanghai",
    "Salary": 12000
  }
]
```

**应用场景**：数据传输、Web API、配置文件。

### 其他格式导出

#### HTML 表格

```python
# 导出为 HTML 表格
df.to_html('table.html', index=False)
```

**应用**：嵌入网页展示数据。

#### SQL 数据库

```python
import sqlite3

# 写入 SQLite 数据库
conn = sqlite3.connect('database.db')
df.to_sql('table_name', conn, if_exists='replace', index=False)
conn.close()
```

**参数说明**：

- `if_exists='replace'`：替换已存在的表
- `if_exists='append'`：追加数据
- `if_exists='fail'`：如果表存在则报错（默认）

### 导出格式对比

| 格式  | 优点                     | 缺点                 | 适用场景         |
| ----- | ------------------------ | -------------------- | ---------------- |
| CSV   | 轻量、通用、纯文本       | 无格式、编码问题     | 数据交换、存储   |
| Excel | 保留格式、多工作表、易用 | 文件大、需要软件打开 | 报告、展示       |
| JSON  | 结构化、Web 友好         | 文件较大、不直观     | API、配置、传输  |
| SQL   | 高效查询、大数据量       | 需要数据库环境       | 持久化存储、共享 |

### 快速保存和加载（Pickle）

```python
# 保存为 Pickle（保留所有 Pandas 信息）
df.to_pickle('data.pkl')

# 加载 Pickle
df = pd.read_pickle('data.pkl')
```

**优点**：

- 速度快
- 完全保留数据类型、索引等所有信息
- 压缩效率高

**缺点**：

- 只能在 Python 中使用
- 不同 Pandas 版本可能不兼容

**应用场景**：Python 项目内部的数据传递和缓存。

## 练习

```bash
python Basic/Pandas/02_io.py
```
