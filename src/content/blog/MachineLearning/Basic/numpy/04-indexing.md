---
title: NumPy 索引与切片
date: 2026-01-04
category: MachineLearning/Basic/numpy
tags:
  - Python
  - NumPy
description: 深入了解 NumPy 数组的索引、切片和高级索引技巧
image: https://img.yumeko.site/file/blog/NumpyLearning.jpg
status: public
---

# 索引和切片

## 学习目标

- 掌握 NumPy 数组的基本索引方法
- 学会使用切片操作访问数组元素
- 理解布尔索引和花式索引

## 为什么索引很重要？

索引和切片是数据处理的基础操作。你需要用它们来：

- 获取特定位置的数据
- 提取数据的子集（如前 100 条记录）
- 根据条件筛选数据（如找出所有大于阈值的值）
- 修改数组中的部分元素

## 索引方式对比

| 索引类型 | 语法                   | 说明               | 返回结果     |
| -------- | ---------------------- | ------------------ | ------------ |
| 基本索引 | `arr[0]`, `arr[1,2]`   | 访问单个元素       | 标量或数组   |
| 切片索引 | `arr[0:5]`, `arr[::2]` | 访问连续或间隔元素 | 数组（视图） |
| 布尔索引 | `arr[arr > 5]`         | 根据条件筛选元素   | 数组（副本） |
| 花式索引 | `arr[[0,2,4]]`         | 使用整数数组索引   | 数组（副本） |

## 基本索引

### 一维数组索引

```python
arr_1d = np.array([10, 20, 30, 40, 50])

# 正向索引（从 0 开始）
print(arr_1d[0])   # 10 (第一个元素)
print(arr_1d[2])   # 30 (第三个元素)
```

**原理**：Python 索引从 0 开始，所以 `arr[0]` 是第一个元素，`arr[1]` 是第二个。

```python
# 负向索引（从 -1 开始，表示倒数第几个）
print(arr_1d[-1])  # 50 (最后一个元素)
print(arr_1d[-2])  # 40 (倒数第二个元素)
```

**技巧**：`-1` 表示最后一个，`-2` 表示倒数第二个，以此类推。不需要知道数组长度就能访问末尾元素。

### 二维数组索引

```python
arr_2d = np.array([[1, 2, 3],
                   [4, 5, 6],
                   [7, 8, 9]])

# 访问单个元素：arr[行, 列]
print(arr_2d[0, 0])   # 1 (第一行第一列)
print(arr_2d[1, 2])   # 6 (第二行第三列)
print(arr_2d[-1, -1]) # 9 (最后一行最后一列)
```

**理解**：`arr_2d[1, 2]` 中，`1` 是行索引（第二行），`2` 是列索引（第三列）。

```python
# 获取整行
print(arr_2d[0])      # [1, 2, 3] (第一行)
print(arr_2d[1])      # [4, 5, 6] (第二行)

# 获取整列需要用切片
print(arr_2d[:, 0])   # [1, 4, 7] (第一列)
```

## 切片语法

```
arr[start:stop:step]
```

| 参数    | 说明               | 默认值   |
| ------- | ------------------ | -------- |
| `start` | 起始索引（包含）   | 0        |
| `stop`  | 结束索引（不包含） | 数组长度 |
| `step`  | 步长               | 1        |

**记忆口诀**：包头不包尾（包含 start，不包含 stop）

### 一维数组切片

```python
arr = np.arange(10)  # [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
```

**示例 1：指定起止**

```python
print(arr[2:7])   # [2, 3, 4, 5, 6]
```

**解读**：从索引 2 开始，到索引 7 之前结束（不包含 7）。

**示例 2：省略参数**

```python
print(arr[:5])    # [0, 1, 2, 3, 4]  从开头到索引 5
print(arr[5:])    # [5, 6, 7, 8, 9]  从索引 5 到结尾
print(arr[:])     # [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]  全部元素
```

**示例 3：使用步长**

```python
print(arr[::2])   # [0, 2, 4, 6, 8]  每隔一个取一个（偶数索引）
print(arr[1::2])  # [1, 3, 5, 7, 9]  从索引 1 开始，每隔一个取一个（奇数索引）
```

**示例 4：负步长（反转）**

```python
print(arr[::-1])  # [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]  数组反转
print(arr[::-2])  # [9, 7, 5, 3, 1]  反向每隔一个取
```

### 二维数组切片

```python
arr = np.arange(20).reshape(4, 5)
print(arr)
```

**结果**：

```
[[ 0  1  2  3  4]
 [ 5  6  7  8  9]
 [10 11 12 13 14]
 [15 16 17 18 19]]
```

```python
# 前 2 行
print(arr[:2, :])
```

**结果**：

```
[[0 1 2 3 4]
 [5 6 7 8 9]]
```

```python
# 第 2-4 列（索引 1, 2, 3）
print(arr[:, 1:4])
```

**结果**：

```
[[ 1  2  3]
 [ 6  7  8]
 [11 12 13]
 [16 17 18]]
```

```python
# 子矩阵：第 2-3 行，第 2-3 列
print(arr[1:3, 1:3])
```

**结果**：

```
[[ 6  7]
 [11 12]]
```

```python
# 每隔一行每隔一列
print(arr[::2, ::2])
```

**结果**：

```
[[ 0  2  4]
 [10 12 14]]
```

## 切片是视图（重要！）

```python
arr = np.array([1, 2, 3, 4, 5])
slice_arr = arr[1:4]  # [2, 3, 4]

# 修改切片会影响原数组！
slice_arr[0] = 100
print(arr)  # [1, 100, 3, 4, 5]
```

**原理**：切片返回的是**视图**（view），指向原数组的同一块内存。修改视图会影响原数组。

**如果需要副本**：

```python
slice_copy = arr[1:4].copy()  # 创建副本
slice_copy[0] = 200
print(arr)  # [1, 100, 3, 4, 5]  原数组不受影响
```

## 布尔索引

布尔索引使用条件表达式筛选元素，是数据分析中最常用的技术之一。

```python
arr = np.arange(1, 11)  # [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
```

### 单条件筛选

```python
# 大于 5 的元素
print(arr[arr > 5])
```

**结果**：`[6 7 8 9 10]`

**工作原理**：

1. `arr > 5` 生成布尔数组：`[False False False False False True True True True True]`
2. 用布尔数组索引，只保留 True 位置的元素

```python
# 偶数元素
print(arr[arr % 2 == 0])
```

**结果**：`[2 4 6 8 10]`

### 多条件筛选

```python
# 3 到 7 之间的元素（使用 & 表示"且"）
print(arr[(arr >= 3) & (arr <= 7)])
```

**结果**：`[3 4 5 6 7]`

```python
# 小于 3 或大于 8 的元素（使用 | 表示"或"）
print(arr[(arr < 3) | (arr > 8)])
```

**结果**：`[1 2 9 10]`

```python
# 不大于 5 的元素（使用 ~ 表示"非"）
print(arr[~(arr > 5)])
```

**结果**：`[1 2 3 4 5]`

> **重要**：多条件组合时，每个条件必须用括号包围！
>
> - 错误：`arr[arr > 3 & arr < 7]`
> - 正确：`arr[(arr > 3) & (arr < 7)]`

## 花式索引

花式索引使用整数数组来指定要获取的元素位置。

```python
arr = np.arange(10, 20)  # [10, 11, 12, 13, 14, 15, 16, 17, 18, 19]

# 获取索引 0, 2, 5, 8 位置的元素
indices = [0, 2, 5, 8]
print(arr[indices])
```

**结果**：`[10 12 15 18]`

**应用场景**：当你有一个索引列表，想一次性获取多个不连续位置的元素。

### 二维数组的花式索引

```python
arr_2d = np.arange(12).reshape(3, 4)
print(arr_2d)
```

**结果**：

```
[[ 0  1  2  3]
 [ 4  5  6  7]
 [ 8  9 10 11]]
```

```python
# 选择第 0 行和第 2 行
print(arr_2d[[0, 2]])
```

**结果**：

```
[[ 0  1  2  3]
 [ 8  9 10 11]]
```

```python
# 选择特定位置的元素：(0,0), (1,1), (2,2)
rows = [0, 1, 2]
cols = [0, 1, 2]
print(arr_2d[rows, cols])
```

**结果**：`[0 5 10]`（对角线元素）

**理解**：`arr_2d[[0,1,2], [0,1,2]]` 实际上是获取 `arr_2d[0,0]`、`arr_2d[1,1]`、`arr_2d[2,2]`。

## np.where 条件索引

`np.where` 是一个功能强大的条件函数，有两种用法。

### 用法 1：返回满足条件的索引

```python
arr = np.array([1, -2, 3, -4, 5, -6])
indices = np.where(arr > 0)
print(indices)
```

**结果**：`(array([0, 2, 4]),)`

**含义**：索引 0, 2, 4 位置的元素大于 0。

### 用法 2：条件替换（三参数形式）

```python
# np.where(条件, 满足时的值, 不满足时的值)

# 负数替换为 0，正数保留
result = np.where(arr > 0, arr, 0)
print(result)
```

**结果**：`[1 0 3 0 5 0]`

```python
# 正数标记为 1，负数标记为 -1
result = np.where(arr > 0, 1, -1)
print(result)
```

**结果**：`[1 -1 1 -1 1 -1]`

**应用场景**：

- 数据清洗：将异常值替换为特定值
- 特征工程：将连续值转换为分类标签

## 小结

| 索引类型 | 语法示例       | 返回类型  | 是否修改原数组     |
| -------- | -------------- | --------- | ------------------ |
| 基本索引 | `arr[0]`       | 元素/数组 | 是                 |
| 切片     | `arr[1:5]`     | 视图      | 是（通过视图修改） |
| 布尔索引 | `arr[arr>5]`   | 副本      | 否                 |
| 花式索引 | `arr[[1,3,5]]` | 副本      | 否                 |

1. **基本索引**：用于访问单个元素或行/列
2. **切片**：用于获取连续的数据片段，返回视图
3. **布尔索引**：用于条件筛选，最常用
4. **花式索引**：用于获取不连续位置的多个元素
5. **np.where**：条件判断和替换的利器

## 练习

运行代码文件查看完整演示：

```bash
python Basic/Numpy/04_indexing.py
```

**练习题**：

1. 创建数组 `[0,1,2,...,19]`，提取所有偶数
2. 创建 5×5 矩阵，提取中间 3×3 的子矩阵
3. 将数组 `[-3, -1, 0, 2, 5]` 中的负数全部替换为 0
