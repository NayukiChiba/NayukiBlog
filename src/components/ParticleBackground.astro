---

---

<canvas id="particle-bg"></canvas>

<style>
  #particle-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
  }
</style>

<script>
  const canvas = document.getElementById('particle-bg') as HTMLCanvasElement;
  const ctx = canvas.getContext('2d')!;

  let width = 0;
  let height = 0;
  let t = 0;

  // ---- 颜色工具 ----
  function hexToRgb(hex: string): [number, number, number] {
    hex = hex.trim().replace(/^#/, '');
    if (hex.length === 3) hex = hex.split('').map((c) => c + c).join('');
    const n = parseInt(hex, 16);
    return [(n >> 16) & 255, (n >> 8) & 255, n & 255];
  }

  function cssColorToRgb(raw: string): [number, number, number] {
    raw = raw.trim();
    if (raw.match(/^#?[0-9a-fA-F]{3,6}$/)) return hexToRgb(raw);
    const m = raw.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
    if (m) return [+m[1], +m[2], +m[3]];
    return [251, 198, 181];
  }

  function lerpRgb(
    a: [number, number, number],
    b: [number, number, number],
    t: number
  ): string {
    return [
      Math.round(a[0] + (b[0] - a[0]) * t),
      Math.round(a[1] + (b[1] - a[1]) * t),
      Math.round(a[2] + (b[2] - a[2]) * t),
    ].join(',');
  }

  function getThemeColors(): [[number,number,number],[number,number,number]] {
    const s = getComputedStyle(document.documentElement);
    return [
      cssColorToRgb(s.getPropertyValue('--radial-c1') || '#FBC6B5'),
      cssColorToRgb(s.getPropertyValue('--radial-c2') || '#F0CFE3'),
    ];
  }

  // ---- 波浪线配置 ----
  interface Wave {
    yRatio: number;   // 垂直位置比例 0~1
    amp: number;      // 振幅（像素）
    freq: number;     // 水平周期数
    speed: number;    // 横向移动速度
    phase: number;    // 初始相位
    colorT: number;   // 颜色插值位置 0~1
    alpha: number;    // 透明度
    lineWidth: number;
  }

  const WAVE_COUNT = 5;
  let waves: Wave[] = [];

  function buildWaves() {
    waves = [];
    for (let i = 0; i < WAVE_COUNT; i++) {
      waves.push({
        yRatio: 0.1 + (i / (WAVE_COUNT - 1)) * 0.8, // 均匀分布 10%~90%
        amp: 18 + Math.random() * 22,
        freq: 1.2 + Math.random() * 1.6,
        speed: 0.12 + Math.random() * 0.18,
        phase: Math.random() * Math.PI * 2,
        colorT: i / (WAVE_COUNT - 1),
        alpha: 0.12 + Math.random() * 0.1,
        lineWidth: 0.8 + Math.random() * 0.6,
      });
    }
  }

  // ---- 绘制 ----
  function draw() {
    ctx.clearRect(0, 0, width, height);
    const [c1, c2] = getThemeColors();

    for (const w of waves) {
      const baseY = w.yRatio * height;
      const color = lerpRgb(c1, c2, w.colorT);

      ctx.beginPath();
      ctx.moveTo(0, baseY + Math.sin(w.phase + t * w.speed) * w.amp);

      for (let x = 2; x <= width; x += 2) {
        const y =
          baseY +
          Math.sin(
            (x / width) * Math.PI * 2 * w.freq + w.phase + t * w.speed
          ) * w.amp;
        ctx.lineTo(x, y);
      }

      ctx.strokeStyle = `rgba(${color},${w.alpha})`;
      ctx.lineWidth = w.lineWidth;
      ctx.stroke();
    }
  }

  function animate() {
    t += 0.012;
    draw();
    requestAnimationFrame(animate);
  }

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
    buildWaves();
  }

  window.addEventListener('resize', resize);
  resize();
  animate();
</script>
