<div id="sakana-widget" style="position: fixed; left: 50px; bottom: 0px; z-index: 999;"></div>
<script>
  import SakanaWidget from 'sakana-widget';
  import 'sakana-widget/lib/index.css';

  // 直接覆盖内置角色，替换为自定义图片
  const elysiaChar = SakanaWidget.getCharacter('chisato')!;
  elysiaChar.image = '/elysia.png';
  SakanaWidget.registerCharacter('chisato', elysiaChar);

  const teriteChar = SakanaWidget.getCharacter('takina')!;
  teriteChar.image = '/teriteri.png';
  SakanaWidget.registerCharacter('takina', teriteChar);

  // 额外新增自定义角色
  const wululuChar = { ...SakanaWidget.getCharacter('chisato')!, image: '/Wululu.png' };
  SakanaWidget.registerCharacter('wululu', wululuChar);

  const kobeChar = { ...SakanaWidget.getCharacter('takina')!, image: '/Kobe.png' };
  SakanaWidget.registerCharacter('kobe', kobeChar);

  // 恢复上次保存的角色，controls: false 隐藏所有内置按钮
  const savedChar = (localStorage.getItem('sakana-character') as 'chisato' | 'takina' | 'wululu' | 'kobe') || 'takina';
  const widget = new SakanaWidget({ character: savedChar, size: 160, controls: false, rod: false }).mount('#sakana-widget');

  // 将实例挂到 window 供 FloatingButton 调用
  (window as any).__sakanaWidget = widget;

  // 读取 localStorage 应用初始显示状态
  // 未设置过时：移动端默认隐藏，桌面端默认显示
  const sakanaEl = document.getElementById('sakana-widget');
  if (sakanaEl) {
    const saved = localStorage.getItem('sakana-hidden');
    const isMobile = window.matchMedia('(max-width: 768px)').matches;
    const isHidden = saved !== null ? saved === 'true' : isMobile;
    sakanaEl.style.display = isHidden ? 'none' : '';
  }
</script>
