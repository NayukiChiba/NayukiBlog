---
// MarkdownStyles.astro - Markdown 内容的全局样式
---

<style is:global>
  :root {
    /* Theme Colors Sync */
    --bg-color: var(--color-bg-secondary, #ffffff);
    --text-color: var(--color-text, #2d2d2d);
    --primary-color: var(--color-primary, #ff9eb5);
    --primary-light: var(--color-primary-light, #ffb8ca);
    --primary-subtle: var(--color-primary-subtle, rgba(255, 158, 181, 0.1));

    /* Code Block Colors - Prism 原版风格 */
    --code-bg: #f5f2f0; /* Prism 原版背景色 */
    --code-header-bg: #ebe8e4;
    --border-color: var(--color-border, #eaecef);

    /* Code Block Dimensions */
    --code-max-height: 480px;

    /* Layout */
    --max-width: 950px;
    --content-padding: 1rem;
    --radius-md: 12px;
  }

  /* HTML/Body resets handled globally */

  /* =========================================
     Code Block Enhanced Styles - Soft Theme
     ========================================= */
  .code-block-wrapper {
    margin: 1.5rem 0;
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 1px solid var(--color-border-light, #f0f0f0);
    background-color: var(--code-bg);
    box-shadow: var(--shadow-sm); /* Soft shadow */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Hover Effect: Lift up slightly + subtle glow */
  .code-block-wrapper:hover {
    box-shadow: var(--shadow-md), 0 0 0 1px var(--primary-subtle);
    transform: translateY(-2px);
  }

  .code-header {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    background-color: rgba(255, 255, 255, 0.8); /* Translucent white */
    backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--color-border-light, #f5f5f5);
    font-family: var(--font-mono, monospace);
    font-size: 0.85rem;
    user-select: none;
  }

  /* Mac-style Window Controls (Red/Yellow/Green dots) */
  .code-header::before {
    content: "";
    display: block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #ff5f56;
    box-shadow: 18px 0 0 #ffbd2e, 36px 0 0 #27c93f;
    margin-right: auto; /* Pushes other items to the right */
    opacity: 0.8;
    transition: opacity 0.2s;
  }
  
  .code-block-wrapper:hover .code-header::before {
      opacity: 1;
  }
  
  /* Mobile: Hide dots if space is tight? Keep them for aesthetics. */

  .code-language {
    font-weight: 700;
    text-transform: uppercase;
    color: var(--color-primary-dark);
    font-size: 0.7rem;
    letter-spacing: 0.05em;
    background-color: var(--primary-subtle);
    padding: 0.2rem 0.6rem;
    border-radius: 8px;
    margin-right: 0.8rem;
    opacity: 0.9;
  }

  .code-actions {
    display: flex;
    gap: 0.4rem;
    align-items: center;
  }

  .code-btn {
    background: transparent;
    border: 1px solid transparent;
    cursor: pointer;
    padding: 5px;
    border-radius: 6px;
    color: #999;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .code-btn:hover {
    background-color: var(--primary-subtle);
    color: var(--color-primary);
    transform: scale(1.05);
  }
  
  .code-btn.active, .code-btn:active {
      transform: scale(0.95);
  }

  .code-content {
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Initial state is expanded, so we don't set max-height or display:none here unless we want to clip */
  
  .code-block-wrapper.collapsed .code-content {
    display: none;
  }

  .code-block-wrapper.collapsed .code-collapse-btn {
    transform: rotate(-90deg);
  }
  
  .code-collapse-btn {
    transition: transform 0.3s ease;
  }
  
  /* Overrides for Prism/Astro default pre */
  .content pre {
    margin: 0 !important;
    border-radius: 0 !important;
    border: none !important;
    padding: 1rem !important;
    overflow-x: auto;
  }
  
  /* Icons */
  .code-actions svg {
    width: 16px;
    height: 16px;
    stroke-width: 2;
  }
  
  .icon-check {
    display: none;
    color: #10b981;
  }
  
  .code-btn.copied .icon-copy {
    display: none;
  }
  .code-btn.copied .icon-check {
    display: inline-block;
  }

  /* =========================================
     Container & Layout
     ========================================= */
  .markdown-container {
    max-width: var(--max-width);
    width: 100%;
    box-sizing: border-box;
    margin: 0 auto;
    padding: 2rem 1rem;
    animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
    overflow-wrap: break-word;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .content {
    max-width: var(--max-width);
    margin: 0 auto;
    margin-bottom: 4rem;
    font-size: 1.05rem; /* Sligthly larger for readability */
  }

  /* Desktop Center Alignment Override */
  @media (min-width: 1400px) {
    .markdown-container {
      margin-right: auto;
    }
  }

  /* Mobile Helpers */
  .mobile-only {
    display: none;
  }
  @media (max-width: 1399px) {
    .mobile-only {
      display: flex;
    }
  }

  /* =========================================
     Typography & Fonts
     ========================================= */
  .content {
    /* Premium Font Stack: Inter -> YaHei UI (Windows) -> PingFang (Mac) */
    font-family:
      "Inter",
      "Microsoft YaHei UI",
      "PingFang SC",
      -apple-system,
      sans-serif;
    color: #374151; /* Softer dark gray */
    line-height: 1.8; /* Roomy line height */
    letter-spacing: 0.01em;
  }

  .content ::selection {
    background: var(--primary-light);
    color: #000;
  }

  /* Headers */
  .content h1,
  .content h2,
  .content h3,
  .content h4,
  .content h5,
  .content h6 {
    color: #1a1a1a;
    font-weight: 700;
    margin-top: 2.5rem;
    margin-bottom: 1.25rem;
    line-height: 1.3;
    position: relative;
    scroll-margin-top: 80px; /* Header clearing */
  }

  /* H1: Left Aligned & Modern */
  .content h1 {
    font-size: 2.2rem;
    text-align: left; /* User request: No center */
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid transparent;
    background: linear-gradient(
        to right,
        var(--border-color),
        transparent
      )
      bottom no-repeat;
    background-size: 100% 1px;
  }

  /* H2: Section Title with Accent */
  .content h2 {
    font-size: 1.65rem;
    padding-left: 1rem;
    border-left: 5px solid var(--primary-color);
    /* Subtle gradient background fade */
    background: linear-gradient(
      90deg,
      var(--primary-subtle) 0%,
      transparent 100%
    );
    border-radius: 0 8px 8px 0;
    padding-top: 0.4rem;
    padding-bottom: 0.4rem;
  }

  /* H3: Clean Subsection */
  .content h3 {
    font-size: 1.35rem;
    padding-left: 0.8rem;
    border-left: 3px solid var(--primary-color);
  }

  /* H4: Bold Text */
  .content h4 {
    font-size: 1.15rem;
    /* padding-left: 0.8rem;
    border-left: 3px solid #cbd5e1; Gray accent */
    color: #4b5563;
  }

  /* Paragraphs & Text */
  .content p {
    margin-bottom: 1.5rem;
    text-align: justify; /* Magazine feel */
  }

  .content strong,
  .content b {
    color: #111;
    font-weight: 700;
  }

  /* Links */
  .content a {
    color: #1a1a1a;
    text-decoration: none;
    font-weight: 600;
    border-bottom: 1.5px solid var(--primary-light);
    transition: all 0.2s ease;
    padding-bottom: 1px;
  }
  .content a:hover {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
    background-color: var(--primary-subtle);
    border-radius: 2px;
  }

  /* =========================================
     Lists
     ========================================= */
  .content ul,
  .content ol {
    margin: 1.2rem 0;
    padding-left: 2rem;
  }

  .content li {
    margin-bottom: 0.8rem; /* Optimized spacing */
    line-height: 1.7;
    position: relative;
  }

  /* Custom UL Bullets */
  .content ul {
    list-style: none;
  }
  .content ul li::before {
    content: "";
    position: absolute;
    left: -1.2rem;
    top: 0.65rem; /* Optical center alignment */
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: var(--primary-color);
    box-shadow: 0 0 0 2px var(--primary-light);
  }

  /* Custom OL Numbers */
  .content ol {
    counter-reset: li;
    list-style: none;
  }
  .content ol li {
    counter-increment: li;
  }
  .content ol li::before {
    content: counter(li);
    position: absolute;
    left: -1.5rem;
    color: var(--primary-color);
    font-weight: 700;
    font-family: "SFMono-Regular", monospace;
    font-size: 0.9em;
  }

  /* =========================================
     Blockquotes (Magazine Style)
     ========================================= */
  .content blockquote {
    margin: 2rem 0;
    padding: 1.5rem 1.8rem; /* Optimized size */
    background-color: var(--bg-color); /* Fallback */
    background: linear-gradient(
      135deg,
      var(--primary-subtle) 0%,
      rgba(255, 255, 255, 0.8) 100%
    );
    border-radius: 12px;
    border-left: none; /* Removed hard border for softer look */
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
  }

  /* Decorative Icon Watermark */
  .content blockquote::before {
    content: "“";
    position: absolute;
    top: -1.5rem;
    left: 0.5rem;
    font-family: serif;
    font-size: 8rem;
    color: var(--primary-color);
    opacity: 0.1;
    pointer-events: none;
    line-height: 1;
  }

  /* Accent line */
  .content blockquote::after {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 5px;
    background: var(--primary-color);
    border-radius: 5px 0 0 5px;
  }

  .content blockquote p {
    position: relative;
    z-index: 1;
    font-style: italic;
    color: #444;
    font-weight: 500;
    margin: 0.8rem 0; /* Optimized paragraph spacing */
  }
  .content blockquote p:last-child {
    margin-bottom: 0;
  }

  /* =========================================
     Code Blocks (Mac Window Style)
     ========================================= */
  /* =========================================
     Code Blocks (Mac Window Style)
     ========================================= */
  .code-wrapper {
    margin: 2rem 0;
    border-radius: 8px; /* Outer radius */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Float effect */
    background-color: var(--code-bg);
    border: 1px solid rgba(0, 0, 0, 0.06);
    overflow: hidden; /* Clip inner content */
  }

  /* The Header Bar */
  .code-header {
    height: 42px; /* Slightly taller for better touch targets */
    background-color: #f1f3f5; /* Clean light gray */
    border-bottom: 1px solid #e1e4e8;
    display: flex;
    align-items: center;
    padding: 0 16px;
    position: relative;
    justify-content: space-between;
  }

  /* Window Controls (Red/Yellow/Green Dots) */
  .window-controls {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }
  .dot.red {
    background-color: #ff5f56;
    border: 1px solid #e0443e;
  }
  .dot.yellow {
    background-color: #ffbd2e;
    border: 1px solid #dea123;
  }
  .dot.green {
    background-color: #27c93f;
    border: 1px solid #1aab29;
  }

  /* Language Label */
  .code-lang {
    font-family: var(--font-mono, monospace);
    font-size: 0.85rem;
    color: #666;
    font-weight: 600;
    text-transform: uppercase;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    pointer-events: none;
  }

  /* Copy Button */
  .copy-btn {
    background: transparent;
    border: none;
    color: #666;
    cursor: pointer;
    padding: 6px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .copy-btn:hover {
    color: var(--primary-color);
    background-color: rgba(0, 0, 0, 0.05);
  }

  /* Code Container */
  .code-container {
    position: relative;
    max-height: var(--code-max-height);
    overflow: hidden;
    transition: max-height 0.4s ease-in-out;
    background-color: var(
      --code-bg
    ); /* Ensure code background matches wrapper */
  }

  /* Gradient Mask for collapsed state */
  .code-wrapper:not(.no-expand):not(.expanded) .code-container::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    right: 0;
    height: 80px;
    background: linear-gradient(
      to bottom,
      transparent,
      var(--code-bg)
    ); /* Match bg */
    pointer-events: none;
  }

  /* Expanded State */
  .code-wrapper.expanded .code-container {
    max-height: none;
  }

  /* Pre/Code Styling - 使用 Prism 原版样式 */
  pre.astro-code,
  .content pre {
    margin: 0 !important;
    padding: 1em !important;
    background: #f5f2f0 !important; /* Prism 原版背景色 */
    color: #000 !important;
    text-shadow: 0 1px #fff;
    overflow-x: auto;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace !important;
    font-size: 1em !important;
    line-height: 1.5 !important; /* Prism 原版行高 */
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    tab-size: 4;
    -moz-tab-size: 4;
    -o-tab-size: 4;
    hyphens: none;
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
  }
  
  /* Shiki 代码行样式 - 空行不需要额外高度 */
  pre.astro-code .line {
    display: inline;
  }
  
  /* 确保空行正常显示 */
  pre.astro-code .line:empty::before {
    content: " ";
  }
  
  pre.astro-code code,
  .content pre code {
    background: transparent !important;
    padding: 0;
    font-family: inherit !important;
    font-size: inherit !important;
    color: inherit;
    text-shadow: inherit;
  }
  
  /* 代码选中样式 - Prism 风格 */
  pre.astro-code ::selection,
  pre.astro-code code ::selection {
    text-shadow: none;
    background: #b3d4fc;
  }

  /* Expand Button (Bottom Bar) */
  .code-expand-btn {
    width: 100%;
    padding: 10px;
    background: #ebe8e4; /* 匹配 Prism header 背景色 */
    border: none;
    border-top: 1px solid #ddd8d0;
    color: #666;
    font-size: 0.9rem;
    cursor: pointer;
    display: none; /* Hidden by default */
    justify-content: center;
    align-items: center;
    gap: 8px;
    transition: background 0.2s;
  }
  .code-expand-btn:hover {
    background: #ddd8d0;
    color: var(--primary-color);
  }

  /* Show button when needed (only for long code blocks) */
  .code-expand-btn {
    display: none;
  }
  .code-wrapper.has-collapse .code-expand-btn {
    display: flex;
  }
  /* Keep button visible when expanded to allow collapsing */
  .code-wrapper.expanded .code-expand-btn svg {
    transform: rotate(180deg);
  }

  /* Make expand button sticky at bottom when expanded? Optional, maybe strictly separate is better */
  .code-wrapper.expanded .code-expand-btn {
    position: sticky;
    bottom: 0;
    z-index: 10;
    border-top: 1px solid var(--border-color);
  }

  /* Inline Code */
  .content :not(pre) > code {
    background-color: rgba(255, 158, 181, 0.15); /* Soft Pink */
    color: #c0394d; /* Reddish for contrast */
    padding: 0.2em 0.4em;
    border-radius: 4px;
    font-family: inherit; /* Use same font as text but monospace styling handled by browser default usually */
    font-size: 0.9em;
  }

  /* =========================================
     Tables
     ========================================= */
  .table-wrapper {
    width: 100%;
    overflow-x: auto;
    margin: 2rem 0;
    border-radius: var(--radius-md);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
  }

  .content table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: #fff;
    min-width: 600px; /* Ensure table doesn't squash too much */
  }

  .content th {
    background-color: #f8f9fa;
    padding: 1rem;
    font-weight: 600;
    text-align: center;
    border-bottom: 2px solid #eaecef;
    color: #111;
    white-space: nowrap;
  }

  .content td {
    padding: 1rem;
    border-bottom: 1px solid #e1e4e8;
    color: #444;
    text-align: center; /* Fixed alignment as requested */
  }

  /* Zebra Striping */
  .content tr:nth-child(even) {
    background-color: #fcfcfc;
  }
  /* Hover row */
  .content tr:hover td {
    background-color: #f1f3f5;
  }

  /* Last row border fix */
  .content tr:last-child td {
    border-bottom: none;
  }

  /* =========================================
     Images & Media
     ========================================= */
  .content img {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 2rem auto;
    border-radius: var(--radius-md);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08); /* Floating effect */
    transition: transform 0.3s ease;
  }
  .content img:hover {
    transform: scale(1.01);
  }

  /* =========================================
     Horizontal Rules
     ========================================= */
  .content hr {
    height: 1px;
    border: none;
    margin: 2rem 0;
    background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
    position: relative;
  }
  /* Decorative Dots */
  .content hr::after {
    content: "•••";
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-color); /* Match page bg */
    padding: 0 1rem;
    color: #d1d5db;
    font-size: 1.2rem;
    letter-spacing: 0.5rem;
  }

  /* =========================================
     Obsidian Callouts
     ========================================= */
  .callout {
    margin: 1.5rem 0;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, 0.08);
    background-color: #fff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
    border-left-width: 4px;
    border-left-style: solid;
  }

  .callout-title {
    padding: 12px 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95rem;
    user-select: none;
  }

  .callout-icon {
    display: flex;
    align-items: center;
    width: 20px;
    height: 20px;
  }

  .callout-icon svg {
    width: 100%;
    height: 100%;
  }

  .callout-content {
    padding: 8px 16px 16px 16px;
    font-size: 0.95rem;
    color: var(--text-color);
    line-height: 1.6;
  }

  .callout-content p {
    margin-bottom: 0.5rem;
  }
  .callout-content p:last-child {
    margin-bottom: 0;
  }

  /* Variants */

  /* Variants */
  /* Note / Info (Blue) */
  .callout-note,
  .callout-info {
    border-left-color: #448aff;
    background-color: rgba(68, 138, 255, 0.02);
  }
  .callout-note .callout-title,
  .callout-info .callout-title {
    color: #2962ff;
  }

  /* Tip (Green) */
  .callout-tip {
    border-left-color: #00c853;
    background-color: rgba(0, 200, 83, 0.02);
  }
  .callout-tip .callout-title {
    color: #009624;
  }

  /* Warning (Yellow/Orange) */
  .callout-warning {
    border-left-color: #ffab00;
    background-color: rgba(255, 171, 0, 0.02);
  }
  .callout-warning .callout-title {
    color: #ff6d00;
  }

  /* Danger (Red) */
  .callout-danger,
  .callout-error {
    border-left-color: #ff1744;
    background-color: rgba(255, 23, 68, 0.02);
  }
  .callout-danger .callout-title,
  .callout-error .callout-title {
    color: #d50000;
  }
</style>
