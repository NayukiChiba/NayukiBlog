---
---
<div class="filter-card">
    <div class="card-header">
        <span>Filters</span>
        <div class="actions">
            <button id="reset-filters" class="btn-link">Reset</button>
        </div>
    </div>
    <div class="filter-body">
        <div class="filter-row">
            <label>Title:</label>
            <input type="text" id="filter-title" placeholder="Search title..." class="form-input">
        </div>
        <div class="filter-row">
            <label>Status:</label>
            <select id="filter-status" class="form-select">
                <option value="">All</option>
                <option value="published">Published</option>
                <option value="draft">Draft</option>
                <option value="recycled">Recycled</option>
            </select>
        </div>
        <div class="filter-row">
            <label>Tags:</label>
            <!-- Simple text input for tags for now, comma separated -->
            <input type="text" id="filter-tags" placeholder="Enter tags..." class="form-input" list="tags-datalist">
            <datalist id="tags-datalist"></datalist>
        </div>
    </div>
</div>

<script>
    const titleInput = document.getElementById('filter-title') as HTMLInputElement | null;
    const statusSelect = document.getElementById('filter-status') as HTMLSelectElement | null;
    const tagsInput = document.getElementById('filter-tags') as HTMLInputElement | null;
    const resetBtn = document.getElementById('reset-filters');

    // Listen for tags data
    document.addEventListener('articles-data-loaded', (e: any) => {
        const { tags } = e.detail;
        const datalist = document.getElementById('tags-datalist');
        if(datalist) {
            datalist.innerHTML = tags.map((t: string) => `<option value="${t}">`).join('');
        }
    });

    function emitFilters() {
        if (!titleInput || !statusSelect || !tagsInput) return;
        const filters = {
            title: titleInput.value,
            status: statusSelect.value,
            tags: tagsInput.value ? tagsInput.value.split(',').map((t: string) => t.trim()).filter((t: string) => t) : []
        };
        document.dispatchEvent(new CustomEvent('filter-changed', { detail: filters }));
    }

    titleInput?.addEventListener('input', debounce(emitFilters, 300));
    statusSelect?.addEventListener('change', emitFilters);
    tagsInput?.addEventListener('input', debounce(emitFilters, 300));

    resetBtn?.addEventListener('click', () => {
        if(titleInput) titleInput.value = '';
        if(statusSelect) statusSelect.value = '';
        if(tagsInput) tagsInput.value = '';
        emitFilters();
    });

    function debounce(func: Function, wait: number) {
        let timeout: ReturnType<typeof setTimeout>;
        return function executedFunction(...args: any[]) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
</script>

<style>
    .filter-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 12px 0 rgba(0,0,0,0.05);
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .card-header {
        padding: 12px 20px;
        border-bottom: 1px solid #ebeef5;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
    }

    .filter-body {
        padding: 20px;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .filter-row {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .filter-row label {
        font-size: 14px;
        color: #606266;
    }

    .form-input, .form-select {
        padding: 6px 10px;
        border: 1px solid #dcdfe6;
        border-radius: 4px;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s;
    }

    .form-input:focus, .form-select:focus {
        border-color: #409eff;
    }

    .btn-link {
        background: none;
        border: none;
        color: #606266;
        cursor: pointer;
        font-size: 14px;
    }
    .btn-link:hover { color: #409eff; }
</style>
