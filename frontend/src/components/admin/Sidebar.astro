---
const navItems = [
  { href: '/admin/articles', label: 'Articles', icon: 'fa-file-alt' },
  { href: '/admin/projects', label: 'Projects', icon: 'fa-project-diagram' },
  { href: '/admin/diary', label: 'Diary', icon: 'fa-book' },
  { href: '/admin/library', label: 'Library', icon: 'fa-book-open' },
  { href: '/admin/gallery', label: 'Gallery', icon: 'fa-images' },
  { href: '/admin/todo', label: 'Todo', icon: 'fa-check-square' },
  { href: '/admin/tools', label: 'Tools', icon: 'fa-tools' },
];

const currentPath = Astro.url.pathname;
---

<div class="sidebar-overlay" id="sidebar-overlay"></div>
<aside class="admin-sidebar" id="admin-sidebar">
    <div class="sidebar-header mobile-only">
        <span class="sidebar-title">管理菜单</span>
        <button id="sidebar-close" class="sidebar-close" aria-label="关闭">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="user-profile">
        <div class="avatar">A</div>
        <div class="info">
            <h3>Administrator</h3>
            <span class="role">Super Admin</span>
        </div>
    </div>
    <nav class="side-nav">
        {navItems.map(item => (
            <a href={item.href} class={currentPath === item.href || (item.href !== '/admin' && currentPath.startsWith(item.href)) ? 'active' : ''}>
                <i class={`fas ${item.icon}`}></i> {item.label}
            </a>
        ))}
    </nav>
</aside>

<script>
    const sidebar = document.getElementById('admin-sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    const closeBtn = document.getElementById('sidebar-close');

    function openSidebar() {
        sidebar?.classList.add('open');
        overlay?.classList.add('visible');
        document.body.style.overflow = 'hidden';
    }

    function closeSidebar() {
        sidebar?.classList.remove('open');
        overlay?.classList.remove('visible');
        document.body.style.overflow = '';
    }

    // 监听来自 Header 的打开指令
    document.addEventListener('open-admin-sidebar', openSidebar);
    
    closeBtn?.addEventListener('click', closeSidebar);
    overlay?.addEventListener('click', closeSidebar);
</script>

<style>
    .admin-sidebar {
        width: 260px;
        background: var(--sidebar-bg, #ffffff);
        border-right: 1px solid var(--border-color, #e5e7eb); /* 改为右边框 */
        padding: 2rem 1rem;
        display: flex;
        flex-direction: column;
        gap: 2rem;
        flex-shrink: 0;
        z-index: 1000;
    }

    /* 移动端抽屉样式 */
    @media (max-width: 1023px) {
        .admin-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            max-width: 80vw;
            transform: translateX(-100%);
            transition: transform 0.3s ease, visibility 0.3s ease;
            visibility: hidden;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .admin-sidebar.open {
            transform: translateX(0);
            visibility: visible;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .mobile-only {
            display: flex;
        }
    }

    @media (min-width: 1024px) {
        .mobile-only {
            display: none;
        }
        .sidebar-overlay {
            display: none;
        }
    }

    .sidebar-header {
        justify-content: space-between;
        align-items: center;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color, #e5e7eb);
    }

    .sidebar-title {
        font-weight: 600;
        color: #1f2937;
    }

    .sidebar-close {
        background: none;
        border: none;
        cursor: pointer;
        color: #6b7280;
        padding: 4px;
    }

    .user-profile {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--border-color, #e5e7eb);
    }

    .avatar {
        width: 48px;
        height: 48px;
        background: #000000;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
    }

    .user-profile .info h3 {
        margin: 0;
        font-size: 1rem;
        color: var(--text-main, #1f2937);
    }

    .user-profile .role {
        font-size: 0.8rem;
        color: var(--text-muted, #6b7280);
    }

    .side-nav {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .side-nav a {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        color: var(--text-main, #1f2937);
        text-decoration: none;
        border-radius: 6px;
        transition: all 0.2s;
    }

    .side-nav a:hover, .side-nav a.active {
        background-color: #f3f4f6;
        color: #000000;
    }

    .side-nav i {
        width: 20px;
        text-align: center;
    }

    @media (max-width: 900px) {
        .admin-sidebar {
            width: auto;
            border-right: none; /* 移动端移除右边框 */
            border-bottom: 1px solid var(--border-color, #e5e7eb);
        }
    }
</style>
